<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Discord Chat Archive — Modern</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{ --bg:#0f1012; --card:#16171a; --muted:#98a0b3; --accent:#5865f2; }
      *{ box-sizing: border-box; }
      html,body{ height:100%; margin:0; font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background: linear-gradient(180deg,#080808 0%, #0f1012 60%); color:#e6eef8; overflow-x: hidden; }
      .app{ min-height:100vh; display:flex; align-items:flex-start; justify-content:center; padding:36px }
      .container{ width:100%; max-width:1000px; display:grid; grid-template-columns: 360px 1fr; gap:20px; align-items:start }
      .sidebar{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:18px; box-shadow: 0 6px 24px rgba(3,6,12,0.6); }
      .main{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:18px; box-shadow: 0 6px 24px rgba(3,6,12,0.6); display:flex; flex-direction:column; max-height: calc(100vh - 120px); }
      h1{ font-size:18px; margin:0 0 10px 0; font-weight:600 }
      .controls{ display:flex; gap:8px; align-items:center; margin-bottom:12px }
      .file-btn, .ghost-btn{ background:var(--accent); color:white; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:600 }
      .ghost-btn{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); font-weight:500 }
      .search{ flex:1; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit }
      #messages{ overflow:auto; border-radius:8px; padding:8px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01)); flex:1; max-height: calc(100vh - 200px); }
      .message{ display:flex; gap:12px; padding:12px; border-radius:10px; align-items:flex-start; transition:background 120ms; max-width:100%; }
      .message:hover{ background:rgba(255,255,255,0.015) }
      .avatar{ width:48px; height:48px; border-radius:12px; background:#111; object-fit:cover; flex-shrink:0 }
      .meta{ display:flex; gap:8px; align-items:center; margin-bottom:6px }
      .author{ font-weight:600; color:#fff }
      .timestamp{ color:var(--muted); font-size:12px }
      .text{ color:#dbe9ff; line-height:1.35; overflow-wrap:anywhere; word-break:break-word; }
      .attachments{ display:flex; gap:8px; margin-top:8px; flex-wrap:wrap }
      .attachment{ width:140px; height:96px; object-fit:cover; border-radius:8px; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,0.5) }
      .empty{ color:var(--muted); padding:40px; text-align:center }
      .footer{ text-align:center; color:var(--muted); font-size:13px; padding-top:8px }

      /* modal */
      .modal-backdrop{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.75)); z-index:2000 }
      .modal-backdrop.show{ display:flex }
      .modal-card{ max-width:90%; max-height:85%; border-radius:12px; overflow:auto }
      .modal-img{ max-width:100%; height:auto; display:block; border-radius:8px }

      @media (max-width:820px){ .container{ grid-template-columns: 1fr; } .sidebar{ order:2 } }
    </style>
  </head>
  <body>
    <div id="root" class="app"></div>

    <!-- React + Babel (lightweight dev build) -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useRef } = React;

      function formatDate(ts){
        try{ return new Date(ts).toLocaleString(); }catch(e){ return ts }
      }

      function App(){
        const [messages, setMessages] = useState([]);
        const [filter, setFilter] = useState('');
        const [modalSrc, setModalSrc] = useState(null);
        const fileInputRef = useRef();

        function openFile(){ fileInputRef.current.click(); }

        function onFile(e){
          const f = e.target.files && e.target.files[0];
          if(!f) return;
          const r = new FileReader();
          r.onload = (ev) => {
            try{
              const data = JSON.parse(ev.target.result);
              // normalize to array of messages
              setMessages(Array.isArray(data) ? data : (data.messages || []));
            }catch(err){ alert('Invalid JSON file') }
          };
          r.readAsText(f);
        }

        function renderMessage(m, i){
          const hasAttachments = m.attachments && m.attachments.length;
          if(filter && !(m.content || '').toLowerCase().includes(filter.toLowerCase()) && !(m.author && m.author.name && m.author.name.toLowerCase().includes(filter.toLowerCase()))) return null;
          return (
            <div className="message" key={i}>
              <img className="avatar" src={m.author && m.author.avatar ? m.author.avatar : 'https://via.placeholder.com/80x80?text=U'} alt="avatar" />
              <div style={{flex:1}}>
                <div className="meta">
                  <div>
                    <div className="author">{m.author ? `${m.author.name}#${m.author.discriminator}` : 'Unknown'}</div>
                    <div className="timestamp">{formatDate(m.timestamp)}</div>
                  </div>
                </div>
                <div className="text">{m.content || ''}</div>
                {hasAttachments ? (
                  <div className="attachments">
                    {m.attachments.map((a,idx)=> (
                      <img key={idx} className="attachment" src={a} onClick={()=>setModalSrc(a)} alt="attachment" />
                    ))}
                  </div>
                ) : null}
              </div>
            </div>
          )
        }

        return (
          <div className="container">
            <div className="sidebar">
              <h1>Discord Chat Archive</h1>
              <div style={{display:'flex',gap:8, marginBottom:12}}>
                <button className="file-btn" onClick={openFile}>Import JSON</button>
                <button className="ghost-btn" onClick={()=>{ setMessages([]) }}>Clear</button>
              </div>
              <input ref={fileInputRef} type="file" accept="application/json" style={{display:'none'}} onChange={onFile} />
              <p style={{color:'var(--muted)', marginTop:6}}>Tip: export Discord JSON or use a channel export. Click attachments to preview.</p>
              <div style={{height:16}}></div>
              <div style={{borderTop:'1px solid rgba(255,255,255,0.02)', paddingTop:12}}>
                <div style={{fontSize:13, color:'var(--muted)', marginBottom:8}}>Messages: <strong style={{color:'#fff'}}>{messages.length}</strong></div>
                <div className="footer">Built with ❤️ by MilitaryLotus</div>
              </div>
            </div>

            <div className="main">
              <div className="controls">
                <input placeholder="Search messages or authors..." className="search" value={filter} onChange={e=>setFilter(e.target.value)} />
                <button className="ghost-btn" onClick={()=>{ setFilter('') }}>Reset</button>
              </div>
              <div id="messages">
                {messages.length === 0 ? (<div className="empty">No messages loaded. Click "Import JSON" to get started.</div>) : messages.map((m,i)=> renderMessage(m,i))}
              </div>
            </div>

            <div className={"modal-backdrop " + (modalSrc ? 'show' : '')} onClick={()=>setModalSrc(null)}>
              {modalSrc && (
                <div className="modal-card" onClick={e=>e.stopPropagation()}>
                  <img className="modal-img" src={modalSrc} alt="preview" />
                </div>
              )}
            </div>
          </div>
        )
      }

      ReactDOM.render(<App />, document.getElementById('root'));
    </script>
  </body>
</html>
